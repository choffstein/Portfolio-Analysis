<%= javascript_include_tag :defaults %> 

<script language="javascript">
  function start_xhr() {
    document.getElementById('busy').style.visibility = 'visible';
    document.getElementById('status').style.visibility = 'visible';
    document.getElementById('results').style.visibility = 'hidden';
  }
  function stop_xhr() {
    document.getElementById('busy').style.visibility = 'hidden';
    document.getElementById('status').style.visibility = 'hidden';
    document.getElementById('results').style.visibility = 'visible';
  }
</script>

<%= periodically_call_remote(:update => "status", :frequency => 1,
                             :url => { :action => :render_status },
                             :condition => "poll") %>

<h1>File Upload</h1>
<% form_tag(:url => {:action => :risk_analysis},
                   :html => {:multipart => true, :target => 'upload_frame'},
                   :loading => "start_xhr()", :complete => "stop_xhr()",
                   :update => 'results') do -%>
<p><label for="upload_file">Select File</label> :
<%= file_field 'upload', 'datafile' %></p>
<%= submit_tag "Perform Analysis" %>
<% end %>

<div id="busy" style="visibility:hidden">
  <%= image_tag "busy.gif" %>
</div>

<div id="status" style="visibility:hidden">
</div>

<div id="results" style="visibility:hidden">
</div>