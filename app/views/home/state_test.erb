<%= javascript_include_tag :defaults %> 

<script language="javascript">
  var poll = false;
  var timeStart;
  var timeDifference;

  function start_xhr() {
    document.getElementById('busy').style.visibility = 'visible';
    document.getElementById('status').style.visibility = 'visible';
    poll = true;
    timeStart = new Date();
  }
  function stop_xhr() {
    document.getElementById('busy').style.visibility = 'hidden';
    document.getElementById('status').style.visibility = 'hidden';
    poll = false;
    var timeEnd = new Date();
    timeDifference = timeEnd.value_of() - timeStart.value_of();
  }
</script>

<%= periodically_call_remote(:update => "status", :frequency => 1,
                             :url => { :action => :render_status },
                             :condition => "poll") %>

<%= link_to_remote "Risk Analysis",
  :loading => "start_xhr()",
  :complete => "stop_xhr()",
  :update => 'results',
  :url => {:action => "risk_analysis"} %>

<div id="busy" style="visibility:hidden">
  <%= image_tag "busy.gif" %>
</div>

<div id="status" style="visibility:hidden">
</div>

<div id="results">
</div>